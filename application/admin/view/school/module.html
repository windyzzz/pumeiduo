<include file="public/layout"/>
<body style="background-color: rgb(255, 255, 255); overflow: auto; cursor: default; -moz-user-select: inherit;">
<div class="page">
    <div class="fixed-bar">
        <div class="item-title">
            <div class="subject">
                <h3>{$module.name}</h3>
            </div>
        </div>
    </div>
    <form method="post" id="datapost1" action="{:U('School/module')}" enctype="multipart/form-data" name="form">
        <div class="ncap-form-default">
            <dl class="row">
                <dt class="tit">
                    <label>模块名</label>
                </dt>
                <dd class="opt">
                    <input type="text" class="input-txt" name="name" value="{$module['name']}" style="text-align: center;">
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label>图标</label>
                </dt>
                <dd class="opt">
                    <div class="goods-thumb">
                        <img class="module_img" style="width: 90px;height: 90px" src="{$module[img]}"/>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <input type="hidden" id="module_img" name="img" value="{$module[img]}" class="type-file-text">
                        <input style="cursor: pointer;" type="button" name="button" value="选择上传..." class="type-file-button" onClick="GetUploadify(1,'module_img','school','img_call_back')">
                        <div style="clear: both;"></div>
                    </div>
                    <p class="notic">长 px，宽 px</p>
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label>排序</label>
                </dt>
                <dd class="opt">
                    <input type="text" name="sort" value="{$module['sort']}" style="text-align: center; width: 10%;"
                           onKeyUp="this.value=this.value.replace(/[^\d]/g,'')"
                           onpaste="this.value=this.value.replace(/[^\d]/g,'')"/>
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label>是否开启</label>
                </dt>
                <dd class="opt onoff">
                    <label for="module_is_open1" class="cb-enable <if condition='$module[is_open] eq 1'>selected</if>">开启</label>
                    <label for="module_is_open0" class="cb-disable <if condition='$module[is_open] eq 0'>selected</if>">隐藏</label>
                    <input id="module_is_open1" name="is_open" <if condition='$module[is_open] eq 1'>checked</if> value="1" type="radio">
                    <input id="module_is_open0" name="is_open" <if condition='$module[is_open] eq 0'>checked</if> value="0" type="radio">
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label>是否允许访问</label>
                </dt>
                <dd class="opt onoff">
                    <label for="module_is_allow1" class="cb-enable <if condition='$module[is_allow] eq 1'>selected</if>">允许访问</label>
                    <label for="module_is_allow0" class="cb-disable <if condition='$module[is_allow] eq 0'>selected</if>">不允许</label>
                    <input id="module_is_allow1" name="is_allow" <if condition='$module[is_allow] eq 1'>checked</if> value="1" type="radio">
                    <input id="module_is_allow0" name="is_allow" <if condition='$module[is_allow] eq 0'>checked</if> value="0" type="radio">
                </dd>
            </dl>
            <div class="bot">
                <input type="hidden" name="type" value="{$module[type]}">
                <a class="ncap-btn-big ncap-btn-green" onclick="updateModule('datapost1')">确认提交</a>
            </div>
        </div>
    </form>
</div>
<div class="page">
    <div class="item-title">
        <ul class="tab-base nc-row">
            <foreach name="class_list" item="v" key="k">
                <li>
                    <a href="{:U('School/module', ['type'=>$module['type'],'class_id'=>$v['id']])}"
                        <if condition="empty($class_id) && $k==0">
                            class="current"
                        <elseif condition="$v['id']==$class_id"/>
                            class="current"
                        </if>
                    >
                        <span>{$v.name}</span>
                    </a>
                </li>
            </foreach>
            <li><a onclick="addModule('{$module.id}', '{$module.type}')"><h1>+</h1></a></li>
        </ul>
    </div>
    <form method="post" id="datapost2" action="{:U('School/updateModuleClass')}" enctype="multipart/form-data" name="form">
        <div class="ncap-form-default">
            <dl class="row">
                <dt class="tit">
                    <label>分类名</label>
                </dt>
                <dd class="opt">
                    <input type="text" class="input-txt" name="name" value="{$module_class['name']}" style="text-align: center;">
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label>排序</label>
                </dt>
                <dd class="opt">
                    <input type="text" name="sort" value="{$module_class['sort']}" style="text-align: center; width: 10%;"
                           onKeyUp="this.value=this.value.replace(/[^\d]/g,'')"
                           onpaste="this.value=this.value.replace(/[^\d]/g,'')"/>
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label>是否开启</label>
                </dt>
                <dd class="opt onoff">
                    <label for="class_is_open1" class="cb-enable <if condition='$module_class[is_open] eq 1'>selected</if>">开启</label>
                    <label for="class_is_open0" class="cb-disable <if condition='$module_class[is_open] eq 0'>selected</if>">隐藏</label>
                    <input id="class_is_open1" name="is_open" <if condition='$module_class[is_open] eq 1'>checked</if> value="1" type="radio">
                    <input id="class_is_open0" name="is_open" <if condition='$module_class[is_open] eq 0'>checked</if> value="0" type="radio">
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label>是否允许访问</label>
                </dt>
                <dd class="opt onoff">
                    <label for="class_is_allow1" class="cb-enable <if condition='$module_class[is_allow] eq 1'>selected</if>">允许访问</label>
                    <label for="class_is_allow0" class="cb-disable <if condition='$module_class[is_allow] eq 0'>selected</if>">不允许</label>
                    <input id="class_is_allow1" name="is_allow" <if condition='$module_class[is_allow] eq 1'>checked</if> value="1" type="radio">
                    <input id="class_is_allow0" name="is_allow" <if condition='$module_class[is_allow] eq 0'>checked</if> value="0" type="radio">
                </dd>
            </dl>
            <dl class="row">
                <dt class="tit">
                    <label>访问限制</label>
                </dt>
                <dd class="opt ctype">
                    <input name="distribute_level[]" type="checkbox" value="0" <if condition="in_array(0, $module_class['distribute_level'])">checked</if> ><label>所有人</label>
                    <input name="distribute_level[]" type="checkbox" value="1" <if condition="in_array(1, $module_class['distribute_level'])">checked</if> ><label>普通会员</label>
                    <input name="distribute_level[]" type="checkbox" value="2" <if condition="in_array(2, $module_class['distribute_level'])">checked</if> ><label>VIP</label>
                    <input name="distribute_level[]" type="checkbox" value="3" <if condition="in_array(3, $module_class['distribute_level'])">checked</if> ><label>SVIP</label>
                </dd>
            </dl>
            <div class="bot">
                <input type="hidden" name="type" value="{$module[type]}">
                <input type="hidden" name="class_id" value="{$module_class[id]}">
                <a class="ncap-btn-big ncap-btn-green" onclick="updateModule('datapost2')">确认提交</a>
            </div>
        </div>
    </form>
</div>

<script type="text/javascript">
    $(document).ready(function () {

        // ajax 抓取页面
        // ajax_get_table('search-form', 1);
    });

    function ajax_get_table(tab, page) {
        $.ajax({
            type: "POST",
            url: "/index.php/Admin/distribut/ajaxDistributeLog/",
            data: $('#' + tab).serialize(),// 你的formid
            success: function (data) {
                $("#flexigrid").html('');
                $("#flexigrid").append(data);
                // 表格行点击选中切换
                $('#flexigrid > table>tbody >tr').click(function () {
                    $(this).toggleClass('trSelected');
                });
            }
        });
    }

    function img_call_back(fileurl_tmp, elementid) {
        $("#" + elementid).val(fileurl_tmp);
        $("." + elementid).attr('src', fileurl_tmp);
    }

    function addModule(module_id, module_type) {
        var url = "{:U('Admin/School/addModuleClass')}/module_id/" + module_id + "/type/" + module_type;
        layer.open({
            type: 2,
            title: '站内信',
            shadeClose: true,
            shade: 0.8,
            area: ['580px', '480px'],
            content: url
        });
    }

    function addModuleCallback(module_type) {
        window.location.href = "{:U('Admin/School/module')}/type/" + module_type;
    }
    
    function updateModule(postId) {
        $('#' + postId).submit();
    }
</script>
</body>
</html>
